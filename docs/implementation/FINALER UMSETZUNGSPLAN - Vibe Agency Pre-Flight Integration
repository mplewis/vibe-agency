# üéØ FINALER UMSETZUNGSPLAN - Vibe Agency Pre-Flight Integration

**Analysiert:** ‚úÖ Repo-Struktur, ‚úÖ State Machine, ‚úÖ Agents, ‚úÖ Workflow
**Status:** Ready for Implementation
**Strategie:** Phased Rollout (3 Sprints)

---

## üìä KRITISCHE ERKENNTNISSE AUS DEM REPO

### Was ich jetzt WIRKLICH verstehe:

1. **Es gibt KEINEN "Orchestrator" als Skript** 
   - Es gibt `AGENCY_OS_ORCHESTRATOR` - das ist ein **Agent** (wie alle anderen)
   - Die State Machine ist **deklarativ** (YAML), nicht imperativ
   - Workflow-√úberg√§nge sind **artifact-basiert** (z.B. `project_manifest.json` triggert n√§chsten State)

2. **Der aktuelle Workflow ist:**
   ```
   PLANNING (project_manifest.json) 
      ‚Üí CODING (artifact_bundle)
      ‚Üí TESTING (qa_report.json)
      ‚Üí AWAITING_QA_APPROVAL
      ‚Üí DEPLOYMENT
      ‚Üí PRODUCTION
   ```

3. **Geminis Kritik ist 100% korrekt:**
   - `LEAN_CANVAS_VALIDATOR` existiert bereits
   - `VIBE_ALIGNER/_prompt_core.md` sagt: "Input Artifacts: None (first agent in workflow)"
   - Das ist **falsch** - `LEAN_CANVAS_VALIDATOR` sollte VOR `VIBE_ALIGNER` sein

4. **Die State Machine hat KEIN "PRE_PLANNING"**
   - Aktuell: `PLANNING` ist der erste State
   - `PLANNING` hat `responsible_framework: "ProjectManagement"` - das ist zu vage

---

## üéØ FINALE L√ñSUNG: Minimale Integration (Geminis Ansatz)

**Warum minimal?**
- Der urspr√ºngliche Claude-Plan (PRE_FLIGHT_CHECK) ist redundant ‚úÖ
- Geminis L√∂sung (nur Integration fixen) ist zu kurz ‚ùå
- Mein hybrider Ansatz (3 Modi) ist zu komplex ‚ùå

**Die RICHTIGE L√∂sung:**
- `LEAN_CANVAS_VALIDATOR` ist der Pre-Flight Check
- Wir fixen die Integration zu `VIBE_ALIGNER`
- Wir kl√§ren die State Machine
- Wir f√ºgen sp√§ter optional `REQUIREMENTS_CLARIFIER` hinzu (wenn Bedarf)

---

## üìã SPRINT 1: Foundation Fix (KRITISCH - SOFORT)

**Ziel:** Integration zwischen `LEAN_CANVAS_VALIDATOR` ‚Üí `VIBE_ALIGNER` herstellen

### 1.1 State Machine pr√§zisieren

**Datei:** `agency_os/core_system/state_machine/ORCHESTRATION_workflow_design.yaml`

**Problem:** `PLANNING` ist zu vage - wer ist daf√ºr verantwortlich?

**L√∂sung:** Aufteilen in zwei Sub-States

```yaml
states:
  - name: "PLANNING"
    description: "Projektplanung und Anforderungsanalyse. Besteht aus zwei Phasen."
    responsible_framework: "ProjectManagement"
    output_artifact: "project_manifest.json"
    sub_states:
      - name: "BUSINESS_VALIDATION"
        description: "Validierung des Gesch√§ftsmodells durch Lean Canvas"
        responsible_agent: "LEAN_CANVAS_VALIDATOR"
        output_artifact: "lean_canvas_summary.json"
        
      - name: "FEATURE_SPECIFICATION"
        description: "Umwandlung validierter Business-Anforderungen in technische Features"
        responsible_agent: "VIBE_ALIGNER"
        input_artifact: "lean_canvas_summary.json"
        output_artifact: "feature_spec.json"

# Neue Transition hinzuf√ºgen
transitions:
  - name: "T0_BusinessToFeatures"
    from_state: "PLANNING.BUSINESS_VALIDATION"
    to_state: "PLANNING.FEATURE_SPECIFICATION"
    trigger: "lean_canvas_summary.json erstellt UND readiness.status == 'READY'"
    type: "Automated"
    
  - name: "T1_StartCoding"
    from_state: "PLANNING.FEATURE_SPECIFICATION"  # GE√ÑNDERT
    to_state: "CODING"
    trigger: "feature_spec.json erstellt mit g√ºltigem code_gen_spec link."
    type: "Automated"
```

**Warum Sub-States?**
- Kompatibel mit der bestehenden State Machine
- Kein Breaking Change (PLANNING bleibt PLANNING)
- Klare Verantwortlichkeiten (wer macht was)

---

### 1.2 VIBE_ALIGNER Input erweitern

**Datei:** `agency_os/01_planning_framework/agents/VIBE_ALIGNER/_prompt_core.md`

**√Ñnderung 1: Input Artifacts aktualisieren**

```markdown
## OPERATIONAL CONTEXT

**Invocation:** Called by AGENCY_OS_ORCHESTRATOR after LEAN_CANVAS_VALIDATOR completes

**Input Artifacts:** 
- **Primary:** `lean_canvas_summary.json` (from LEAN_CANVAS_VALIDATOR)
- **Fallback:** None (if user skips business validation - legacy mode)

**Output Artifacts:** `feature_spec.json` (passed to GENESIS_BLUEPRINT)

**Execution Model:** Sequential phases (1‚Üí6), each with specific goals and validation gates
```

**√Ñnderung 2: Purpose Statement aktualisieren**

```markdown
**PURPOSE:** Transform validated business requirements (from Lean Canvas) into concrete, buildable feature specifications
```

---

### 1.3 VIBE_ALIGNER Task 01 - Conditional Logic

**Datei:** `agency_os/01_planning_framework/agents/VIBE_ALIGNER/tasks/task_01_education.md`

**Neue Sektion am Anfang hinzuf√ºgen:**

```markdown
## INPUT CONTEXT CHECK

Before starting education, check if `lean_canvas_summary.json` exists:

### IF lean_canvas_summary.json EXISTS:
```json
{
  "business_context": {...},
  "success_criteria": {...},
  "constraints": {...}
}
```

**Action:**
1. SHOW: Brief recap of business context
   - "Based on your Lean Canvas, I understand you're building [PROBLEM] for [CUSTOMER_SEGMENTS]"
2. ASK: "Is this scope still correct, or has anything changed?"
3. IF no changes:
   - Skip full education
   - Extract MVP/v1.0 decision from `success_criteria`
   - Jump to Task 02 (Feature Extraction)
4. IF changes:
   - Update scope
   - Continue with education

### IF lean_canvas_summary.json DOES NOT EXIST:
**Action:**
- Run full education phase as designed below
- User is starting without business validation (legacy mode)

---

## ORIGINAL EDUCATION PHASE (Full Version)

[... rest of task_01 bleibt unver√§ndert ...]
```

---

### 1.4 LEAN_CANVAS_VALIDATOR Handoff pr√§zisieren

**Datei:** `agency_os/01_planning_framework/agents/LEAN_CANVAS_VALIDATOR/tasks/task_03_handoff.md`

**Neue Sektion hinzuf√ºgen:**

```markdown
## HANDOFF TO VIBE_ALIGNER

After creating `lean_canvas_summary.json`, inform the user:

---

**‚úÖ Business Validation Complete**

Your Lean Canvas is validated and saved. Here's what happens next:

**Next Agent:** VIBE_ALIGNER (Feature Specification)

**What VIBE_ALIGNER will do:**
- Use your business context to extract features
- Validate technical feasibility
- Create a buildable feature specification

**What you need to do:**
- Describe the features you envision for v1.0
- VIBE_ALIGNER will already know your constraints, success criteria, and business context

**Ready to continue?** (Type 'yes' or describe your first feature)

---
```

---

### 1.5 Data Contract f√ºr lean_canvas_summary.json

**Datei:** `agency_os/core_system/contracts/ORCHESTRATION_data_contracts.yaml`

**Hinzuf√ºgen:**

```yaml
lean_canvas_summary:
  version: "1.0"
  description: "Output von LEAN_CANVAS_VALIDATOR, Input f√ºr VIBE_ALIGNER"
  schema:
    type: object
    required: ["version", "canvas_fields", "riskiest_assumptions", "readiness"]
    properties:
      version:
        type: string
        const: "1.0"
      canvas_fields:
        type: object
        required: ["problem", "customer_segments", "unique_value_proposition", 
                   "solution", "channels", "revenue_streams", "cost_structure",
                   "key_metrics", "unfair_advantage"]
        properties:
          problem:
            type: string
          customer_segments:
            type: string
          # ... (rest der 9 Felder)
      riskiest_assumptions:
        type: array
        items:
          type: object
          properties:
            assumption:
              type: string
            why_risky:
              type: string
            validation_method:
              type: string
      readiness:
        type: object
        required: ["status", "confidence_level"]
        properties:
          status:
            type: string
            enum: ["READY", "NOT_READY"]
          confidence_level:
            type: string
            enum: ["high", "medium", "low"]
          missing_inputs:
            type: array
            items:
              type: string
```

---

## üìã SPRINT 2: Optionalit√§t (SP√ÑTER - BEI BEDARF)

**Ziel:** User k√∂nnen Lean Canvas √ºberspringen (f√ºr technische Projekte)

### 2.1 Skip-Logik in AGENCY_OS_ORCHESTRATOR

**Datei:** `agency_os/core_system/agents/AGENCY_OS_ORCHESTRATOR/tasks/task_01_workflow_init.md`

**Neue Sektion:**

```markdown
## PLANNING MODE SELECTION

After user describes project, analyze if business validation is needed:

### Auto-Detection Rules:
- IF keywords: ["startup", "revenue", "business model", "customers", "market"] 
  ‚Üí Recommend LEAN_CANVAS_VALIDATOR
- IF keywords: ["internal tool", "refactoring", "migration", "no revenue"]
  ‚Üí Offer to skip to VIBE_ALIGNER
- ELSE
  ‚Üí Ask user

### User Prompt:
"I detected this is a [business/technical] project. Would you like to:
A) Start with Business Validation (Lean Canvas) - Recommended for new products
B) Skip to Feature Specification - For technical projects without business model

Your choice: [A/B]"

### Routing:
- IF A ‚Üí Start with LEAN_CANVAS_VALIDATOR
- IF B ‚Üí Create empty lean_canvas_summary.json with flag `skipped: true`, start VIBE_ALIGNER
```

---

### 2.2 VIBE_ALIGNER Fallback-Modus

**Datei:** `agency_os/01_planning_framework/agents/VIBE_ALIGNER/_prompt_core.md`

**Erweitern:**

```markdown
**Input Artifacts:** 
- **Primary:** `lean_canvas_summary.json` (from LEAN_CANVAS_VALIDATOR)
- **Fallback:** If `lean_canvas_summary.skipped == true`, run full education phase
```

---

## üìã SPRINT 3: REQUIREMENTS_CLARIFIER (OPTIONAL - FUTURE)

**Ziel:** Leichtgewichtiger Pre-Flight Check f√ºr technische Projekte

**Nur wenn Sprint 2 zeigt, dass technische Projekte nicht gut mit Lean Canvas passen**

### 3.1 Neuer Agent erstellen

```
agency_os/01_planning_framework/agents/REQUIREMENTS_CLARIFIER/
‚îú‚îÄ‚îÄ _prompt_core.md
‚îú‚îÄ‚îÄ _composition.yaml
‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îú‚îÄ‚îÄ task_01_functional_requirements.md
‚îÇ   ‚îú‚îÄ‚îÄ task_02_constraints.md
‚îÇ   ‚îú‚îÄ‚îÄ task_03_success_criteria.md
‚îÇ   ‚îî‚îÄ‚îÄ task_04_handoff.md
‚îî‚îÄ‚îÄ gates/
    ‚îî‚îÄ‚îÄ gate_requirements_clear.md
```

**Output:** `requirements_brief.json` (√§hnlich wie `lean_canvas_summary.json`, aber ohne Business-Felder)

---

## üéØ ZUSAMMENFASSUNG: Was wird wann gemacht?

### ‚úÖ SPRINT 1 (SOFORT - 4-6 Stunden):
1. State Machine: Sub-States f√ºr PLANNING
2. VIBE_ALIGNER: Input Artifacts + Purpose aktualisieren
3. VIBE_ALIGNER Task 01: Conditional Logic
4. LEAN_CANVAS_VALIDATOR Task 03: Handoff-Text
5. Data Contract: lean_canvas_summary.json Schema

**Result:** `LEAN_CANVAS_VALIDATOR` ‚Üí `VIBE_ALIGNER` Integration funktioniert

---

### ‚è≥ SPRINT 2 (BEI BEDARF - 2-3 Stunden):
1. AGENCY_OS_ORCHESTRATOR: Planning Mode Selection
2. VIBE_ALIGNER: Fallback Mode f√ºr skipped Lean Canvas

**Result:** User k√∂nnen Lean Canvas √ºberspringen

---

### üîÆ SPRINT 3 (FUTURE - 8-10 Stunden):
1. REQUIREMENTS_CLARIFIER Agent erstellen
2. State Machine: Dritte Option hinzuf√ºgen
3. Integration testen

**Result:** Leichtgewichtiger Pre-Flight f√ºr technische Projekte

---

## üöÄ N√ÑCHSTER SCHRITT

**Ich empfehle: Start mit Sprint 1**