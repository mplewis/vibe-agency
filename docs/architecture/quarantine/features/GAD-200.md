# GAD-200: Core Orchestration & SDLC Workflow

**Status:** ✅ IMPLEMENTED (Migrated from GAD-002)
**Date:** 2025-11-17
**Pillar:** GAD-2XX (Core Orchestration & SDLC Workflow)
**Priority:** P0 (Core system architecture)

---

## Executive Summary

**Pillar 2 (GAD-2XX)** encompasses the Core Orchestration system - the central state machine that manages the full SDLC workflow from PLANNING through MAINTENANCE.

**Components:**
1. **Core Orchestrator** (core_orchestrator.py)
2. **Phase Handlers** (planning, coding, testing, deployment, maintenance)
3. **State Machine** (workflow definitions, transitions, quality gates)

**Historical Context:**
- **GAD-002 (2025-11-14):** Core SDLC Orchestration Architecture (original design doc)
- **Implemented:** Hierarchical Orchestrator pattern (Core + Phase Handlers)
- **Status:** 4/5 phases implemented (TESTING + MAINTENANCE are stubs)

---

## Architecture

### Hierarchical Orchestrator Pattern

**Decision:** Option B from GAD-002 (Hierarchical Orchestrator)
**Rationale:** Scalability, maintainability, single responsibility

```
agency_os/00_system/orchestrator/
├── core_orchestrator.py              # State machine + coordination
├── orchestrator.py                   # Legacy (deprecated)
└── handlers/
    ├── planning_handler.py           # ✅ COMPLETE
    ├── coding_handler.py             # ✅ COMPLETE
    ├── testing_handler.py            # ⚠️ STUB
    ├── deployment_handler.py         # ✅ COMPLETE
    └── maintenance_handler.py        # ⚠️ STUB
```

---

## Implementation Status

### ✅ Implemented Components

**Core Orchestrator:**
- State machine (PLANNING → CODING → TESTING → DEPLOYMENT → MAINTENANCE)
- Phase transitions with quality gates
- Artifact persistence (project_manifest.json)
- Session handoff integration
- GAD-005 Runtime Engineering integration (MOTD, Kernel)

**Verification:**
```bash
wc -l agency_os/00_system/orchestrator/core_orchestrator.py
uv run pytest tests/test_orchestrator_state_machine.py -v
```

**Phase Handlers:**

| Phase | Status | Lines | Tests | Verify Command |
|-------|--------|-------|-------|----------------|
| PLANNING | ✅ Complete | 211 | ✅ Pass | `uv run pytest tests/test_planning_workflow.py -v` |
| CODING | ✅ Complete | 211 | ✅ Pass | `uv run pytest tests/test_coding_workflow.py -v` |
| TESTING | ⚠️ Stub | 108 | ⚠️ Stub | `grep -n "STUB" agency_os/00_system/orchestrator/handlers/testing_handler.py` |
| DEPLOYMENT | ✅ Complete | 272 | ✅ Pass | `uv run pytest tests/test_deployment_workflow.py -v` |
| MAINTENANCE | ⚠️ Stub | 106 | ⚠️ Stub | `grep -n "STUB" agency_os/00_system/orchestrator/handlers/maintenance_handler.py` |

**Integration Systems:**

- ✅ File-Based Delegation (GAD-003) - Agents communicate via delegation/ JSON files
- ✅ Quality Gates (GAD-004) - Multi-layered quality enforcement
- ✅ Runtime Engineering (GAD-005) - MOTD, Kernel, Layer 0 checks
- ✅ VibeConfig (GAD-100 Phase 3) - Config management integration

---

## Key Architectural Decisions (from GAD-002)

### Decision 1: Hierarchical Orchestrator (Option B) ✅ CHOSEN

**Structure:**
```python
class CoreOrchestrator:
    def execute_full_sdlc(self, project_id: str) -> None:
        """Master loop through all phases"""
        while not self.is_complete():
            current_phase = self.get_current_phase()
            handler = self.get_phase_handler(current_phase)
            handler.execute(project_id)  # Delegate to phase handler

class PlanningHandler:
    def execute(self, project_id: str) -> None:
        """Execute PLANNING phase logic"""
```

**Benefits:**
- Clear separation of concerns
- Each handler is independently testable
- Can parallelize development (different phases = different PRs)
- Easier to maintain (200-300 lines per handler vs 2000+ monolith)

**Trade-offs:**
- More files (5 handlers vs 1 orchestrator)
- Interface consistency needed between handlers

### Decision 2: STEWARD Integration Pattern

**Choice:** Horizontal governance via quality gates
**Implementation:** AUDITOR agent invoked at key transition points
**Status:** ✅ Implemented (GAD-004)

**Quality Gates:**
- Business validation complete before feature spec
- Architecture approved before coding
- Security scan before deployment

### Decision 3: Schema Validation

**Choice:** Enforce data contracts via canonical schemas
**Implementation:** GAD-100 Phase 2 (project_manifest.schema.json)
**Status:** ✅ Implemented

**Validation Points:**
- Artifact creation (project_manifest.json)
- State transitions (phase changes)
- Session handoff files

### Decision 4: Multi-Project Support

**Choice:** Workspace-based isolation
**Implementation:** Each project gets own workspace directory
**Status:** ✅ Implemented

**Pattern:**
```
workspaces/
├── project-1/
│   ├── project_manifest.json
│   └── artifacts/
└── project-2/
    ├── project_manifest.json
    └── artifacts/
```

---

## Current State (As of 2025-11-17)

### Working Workflows

**PLANNING → CODING:**
```bash
uv run pytest tests/test_planning_workflow.py -v
uv run pytest tests/test_coding_workflow.py -v
# Result: ✅ PASSES (end-to-end workflow tested)
```

**PLANNING → DEPLOYMENT:**
```bash
uv run pytest tests/test_deployment_workflow.py -v
# Result: ✅ PASSES (deployment handler complete)
```

**State Machine:**
```bash
uv run pytest tests/test_orchestrator_state_machine.py -v
# Result: ✅ PASSES (transitions validated)
```

### Known Gaps (from GAD-002)

**P0 Gaps Resolved:**
- ✅ SDLC-Orchestrator complete (4/5 phases working)
- ✅ STEWARD integrated (quality gates)
- ✅ Schema validation (GAD-100 Phase 2)

**P1 Gaps Remaining:**
- ⚠️ TESTING handler (stub only)
- ⚠️ MAINTENANCE handler (stub only)

**P2 Gaps (Deferred):**
- Cost management (no budget tracking yet)
- State recovery (no checkpoint/resume yet)
- Knowledge lifecycle (no versioning/freshness tracking yet)

---

## Verification Commands

```bash
# Core orchestrator
ls -la agency_os/00_system/orchestrator/
wc -l agency_os/00_system/orchestrator/*.py
wc -l agency_os/00_system/orchestrator/handlers/*.py

# Tests
uv run pytest tests/test_orchestrator_state_machine.py -v
uv run pytest tests/test_planning_workflow.py -v
uv run pytest tests/test_coding_workflow.py -v
uv run pytest tests/test_deployment_workflow.py -v

# Integration
uv run pytest tests/test_multi_layer_integration.py -v  # GAD-004 Phase 4
uv run pytest tests/e2e/test_orchestrator_e2e.py -v    # E2E validation
```

---

## Sub-Documents (GAD-2XX Series)

- **GAD-200:** This document (Core Orchestration EPIC)
- **GAD-201:** Testing Handler Implementation (Planned)
- **GAD-202:** Maintenance Handler Implementation (Planned)
- **GAD-203:** Cost Management & Rate Limiting (Planned)
- **GAD-204:** State Recovery & Checkpointing (Planned)

---

## Cross-Pillar Dependencies

**GAD-2XX depends on:**
- **GAD-1XX (Planning):** Planning handler invokes planning framework
- **GAD-3XX (Agent Framework):** Orchestrator uses agent execution patterns
- **GAD-4XX (Quality):** Quality gates integrated into state machine
- **GAD-5XX (Runtime Eng):** MOTD/Kernel run before orchestrator execution

**Other pillars depend on GAD-2XX:**
- **GAD-1XX (Planning):** Planning framework needs orchestrator to coordinate
- **GAD-4XX (Quality):** Quality gates triggered by orchestrator
- **GAD-8XX (Integration):** Integration tests validate orchestrator behavior

---

## Migration Notes

**Migrated from:**
- GAD-002: Core SDLC Orchestration Architecture (2025-11-14 design doc)

**Files archived:**
- docs/architecture/archive/pre-migration/GAD-002_Core_SDLC_Orchestration.md
- docs/architecture/archive/pre-migration/GAD-002_VERIFICATION_HARNESS.md

**References updated:**
- ARCHITECTURE_MAP.md: GAD-002 → GAD-2XX
- INDEX.md: GAD-2XX pillar defined

---

**Last Updated:** 2025-11-17
**Next Review:** After TESTING and MAINTENANCE handlers implemented
**Maintainer:** Architecture Team
