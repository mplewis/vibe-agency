composition_version: "2.0"
agent_id: GENESIS_BLUEPRINT
agent_version: "6.0"  # Bumped from v5.0 after refactoring

# How the PromptRuntime should combine prompt fragments
composition_order:
  - source: _prompt_core.md
    type: base
    required: true
    description: "Agent personality, identity, and core constraints"

  - source: ${knowledge_files}
    type: knowledge
    required: true
    resolve_from: _knowledge_deps.yaml
    description: "YAML knowledge base files (FAE, data contracts)"

  - source: ${task_prompt}
    type: task
    required: true
    path_pattern: tasks/${task_id}.md
    description: "Specific task instructions (select_core_modules, design_extensions, etc.)"

  - source: ${gate_prompts}
    type: validation
    required: false
    resolve_from: tasks/${task_id}.meta.yaml#validation_gates
    path_pattern: gates/${gate_id}.md
    description: "Validation gates for this task (stdlib_only, extension_isolation, etc.)"

  - source: ${runtime_context}
    type: context
    required: true
    description: "Runtime-provided context (project_id, current_phase, artifact paths)"

# Variable substitution (runtime will inject these)
variables:
  project_id: ${runtime_context.project_id}
  current_phase: ${runtime_context.current_phase}
  feature_spec_path: ${runtime_context.artifacts.feature_spec}
  workspace_path: ${runtime_context.workspace_path}

# Conflict resolution (if two prompts define the same section)
conflict_resolution:
  strategy: last_wins  # Later prompts override earlier ones
  exceptions:
    # These sections are MERGED, not overwritten
    - section: CRITICAL_CONSTRAINTS
      strategy: merge_all
    - section: REQUIRED_INPUTS
      strategy: merge_all
    - section: VALIDATION_GATES
      strategy: merge_all

# Metadata
metadata:
  created: "2025-11-12"
  purpose: "Defines how to compose GENESIS_BLUEPRINT prompts from fragments"
  refactored_from: GENESIS_BLUEPRINT_v5.md
