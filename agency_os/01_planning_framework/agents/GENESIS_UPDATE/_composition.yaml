composition_version: "2.0"
agent_id: GENESIS_UPDATE
agent_version: "2.0"  # Atomized from v1.0

# How the PromptRuntime should combine prompt fragments
composition_order:
  - source: _prompt_core.md
    type: base
    required: true
    description: "Agent identity, core responsibilities, and anti-drift mechanisms"

  - source: ${knowledge_files}
    type: knowledge
    required: true
    resolve_from: _knowledge_deps.yaml
    description: "YAML knowledge base files (FAE, FDG, data contracts)"

  - source: ${task_prompt}
    type: task
    required: true
    path_pattern: tasks/${task_id}.md
    description: >
      Specific task instructions (change_analysis, feasibility_check,
      ripple_effect_analysis, diff_patch_generation,
      consistency_validation, output_generation)

  - source: ${gate_prompts}
    type: validation
    required: false
    resolve_from: tasks/${task_id}.meta.yaml#validation_gates
    path_pattern: gates/${gate_id}.md
    description: "Validation gates for this task (no_full_regeneration, no_orphaned_deps, diff_format_valid)"

  - source: ${runtime_context}
    type: context
    required: true
    description: "Runtime-provided context (project_id, existing_architecture, change_request)"

# Variable substitution (runtime will inject these)
variables:
  project_id: ${runtime_context.project_id}
  existing_architecture_path: ${runtime_context.artifacts.architecture_json}
  change_request: ${runtime_context.change_request}
  workspace_path: ${runtime_context.workspace_path}

# Conflict resolution (if two prompts define the same section)
conflict_resolution:
  strategy: last_wins  # Later prompts override earlier ones
  exceptions:
    # These sections are MERGED, not overwritten
    - section: CRITICAL_CONSTRAINTS
      strategy: merge_all
    - section: REQUIRED_INPUTS
      strategy: merge_all
    - section: VALIDATION_GATES
      strategy: merge_all

# Metadata
metadata:
  created: "2025-11-12"
  purpose: "Defines how to compose GENESIS_UPDATE prompts from fragments"
  refactored_from: GENESIS_UPDATE.md
