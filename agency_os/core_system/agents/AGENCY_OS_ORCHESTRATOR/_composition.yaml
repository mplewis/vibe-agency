composition_version: "2.0"
agent_id: AGENCY_OS_ORCHESTRATOR
agent_version: "2.0"  # Atomized from v1.0

# How the PromptRuntime should combine prompt fragments
composition_order:
  - source: _prompt_core.md
    type: base
    required: true
    description: "Agent identity, core workflow, and state machine logic"

  - source: ${knowledge_files}
    type: knowledge
    required: true
    resolve_from: _knowledge_deps.yaml
    description: "YAML knowledge base files (workflow design, data contracts)"

  - source: ${task_prompt}
    type: task
    required: true
    path_pattern: tasks/${task_id}.md
    description: "Specific state handler (handle_planning, handle_coding, handle_testing, handle_qa_approval, handle_deployment, handle_maintenance)"

  - source: ${gate_prompts}
    type: validation
    required: true
    resolve_from: tasks/${task_id}.meta.yaml#validation_gates
    path_pattern: gates/${gate_id}.md
    description: "Validation gates for this state (state_integrity, artifact_presence)"

  - source: ${runtime_context}
    type: context
    required: true
    description: "Runtime-provided context (project_id, current_state, trigger_event)"

# Variable substitution (runtime will inject these)
variables:
  project_id: ${runtime_context.project_id}
  current_state: ${runtime_context.current_state}
  trigger_event: ${runtime_context.trigger_event}
  manifest_path: ${runtime_context.project_manifest_path}
  workspace_path: ${runtime_context.workspace_path}

# Conflict resolution (if two prompts define the same section)
conflict_resolution:
  strategy: last_wins  # Later prompts override earlier ones
  exceptions:
    # These sections are MERGED, not overwritten
    - section: CRITICAL_SUCCESS_CRITERIA
      strategy: merge_all
    - section: ANTI_SLOP_ENFORCEMENT
      strategy: merge_all
    - section: VALIDATION_GATES
      strategy: merge_all

# Metadata
metadata:
  created: "2025-11-12"
  purpose: "Defines how to compose AGENCY_OS_ORCHESTRATOR prompts from fragments"
  refactored_from: AGENCY_OS_ORCHESTRATOR_v1.md
